<!DOCTYPE html>
<html lang="EN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SM.studio ai</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f1f1f1;
            --text-color: #333;
            --bg-color: #fff;
            --sidebar-bg: #f9f9f9;
            --chat-user-bg: rgb(144, 185, 185);
            --chat-ai-bg: rgb(196, 255, 201);
            --code-bg: #f5f5f5;
            --table-header-bg: #e0e0e0;
            --table-row-even: #f9f9f9;
            --table-row-odd: #ffffff;
            --icon-color: rgb(100, 14, 54);
            --iput-bg: azure;
        }

        .dark-mode {
            --primary-color: #2196f3;
            --secondary-color: #424242;
            --text-color: #f1f1f1;
            --bg-color: #121212;
            --sidebar-bg: #1e1e1e;
            --chat-user-bg: #1a3a4a;
            --chat-ai-bg: #1a2e1a;
            --code-bg: #2d2d2d;
            --table-header-bg: #333333;
            --table-row-even: #2a2a2a;
            --table-row-odd: #222222;
            --icon-color: rgb(219, 33, 120);
            --iput-bg: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            line-height: 1.6;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            padding: 20px;
            transition: transform 0.3s;
        }

        .sidebar.closed {
            transform: translateX(-250px);
        }

        .content {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 24px;
            cursor: pointer;
            position: fixed;
            top: 20px;
            left: 250px;
            margin-bottom: 20px;
        }

        .mylist{
            padding: 2rem;
            background-color: var(--chat-user-bg);
            color: var(--text-color);
            list-style: none;
        }

        .mylist li{
            background-color: var(--chat-user-bg);
            padding: 8px;
            margin: 10px auto;
            cursor: pointer;
        }

        .mylist li i{
            color: var(--icon-color);
            font-size: 24px;
            padding-right: 10px;
        }
        .mylist li:hover{
            box-shadow: 0 0.8rem 1.3rem rgba(0,0,0,0.4);
            border-radius: 8px;
        }

        .chat-container {
            flex-grow: 1;
            overflow-y: auto;
            border: 1px solid var(--secondary-color);
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 20px;
        }

        /* تنسيق الرسائل والـ Avatar */
        .message-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }
        
        /* رسائل المستخدم */
        .user-message-wrapper {
            justify-content: flex-end;
        }
        
        .user-message {
            background-color: var(--chat-user-bg, #0084ff);
            color: white;
            padding: 10px;
            border-radius: 10px;
            max-width: 60%;
            margin-left: auto;
            text-align: left;
        }
        
        /* رسائل AI */
        .ai-message-wrapper {
            justify-content: flex-start;
        }
        
        .ai-message {
            background-color: var(--chat-ai-bg, #f1f1f1);
            color: black;
            padding: 10px;
            border-radius: 10px;
            max-width: 90%;
            text-align: left;
        }
        

        

        .input-container {
            display: flex;
        }

        #user-input {
            flex-grow: 1;
            padding: 15px;
            background-color: var(--iput-bg);
            box-shadow: 0 0 10px rgba(0,0,0,0.4);
            border-top-left-radius: 24px;
            border-bottom-left-radius: 24px;
            outline: none;
            border: none;
            
        }

        #send-button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: var(--text-color);
            border: none;
            border-top-right-radius: 24px;
            border-bottom-right-radius: 24px;
            cursor: pointer;
        }

        .mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 24px;
            cursor: pointer;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            border-radius: 8px;
            margin-bottom: 1em;
        }

        th, td {
            border: 1px solid var(--secondary-color);
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: var(--table-header-bg);
            color: var(--text-color);
        }

        tr:nth-child(even) {
            background-color: var(--table-row-even);
        }

        tr:nth-child(odd) {
            background-color: var(--table-row-odd);
        }

        pre {
            background-color: var(--code-bg);
            border: 1px solid var(--secondary-color);
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            position: relative;
            direction: ltr;
            text-align: left;
        }

        code {
            font-family: 'Courier New', Courier, monospace;
            overflow-x: auto;
        }

        .copy-button, .run-button {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }

        .run-button {
            left: 70px;
        }

        .message p {
            margin-bottom: 10px;
            margin-left: 10px;
        }

        .message ul, .message ol {
            margin-right: 30px;
            margin-bottom: 12px;
        }

        .message h1, .message h2, .message h3, .message h4 {
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .message blockquote {
            border-right: 3px solid var(--primary-color);
            margin: 10px 0;
            padding-right: 10px;
            color: var(--text-color);
            font-style: italic;
        }

        .message hr {
            border: none;
            border-top: 1px solid var(--secondary-color);
            margin: 15px 0;
        }

        .table-controls {
            margin-bottom: 10px;
        }

        .table-controls button {
            margin-left: 5px;
            padding: 5px 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        #color-picker {
            margin-right: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: var(--bg-color);
            margin: 15% auto;
            padding: 20px;
            border: 1px solid var(--secondary-color);
            width: 80%;
            max-width: 600px;
            border-radius: 5px;
        }

        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        #preview-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <button class="toggle-sidebar" id="toggle-sidebar">
                <i class="fas fa-bars"></i>
            </button>
            <h2>List</h2>
            <ul id="myList" class="mylist">
                <li><i class="fas fa-home"></i>Home</li>
                <li><i class="fas fa-cog"></i>Settings</li>
                <li><i class="fas fa-history"></i>Hestory</li>
                <li><i class="fas fa-info-circle"></i>About</li>
            </ul>
        </div>
        <div class="content">
            <button class="mode-toggle" id="mode-toggle">
                <i class="fas fa-moon"></i>
            </button>
            <h1>Advanced Chat-bot ai</h1>
            <div class="chat-container" id="chat-container"></div>
            <div class="input-container">
                <input type="text" id="user-input" placeholder="Write your message here...">
                <button id="send-button">Send</button>
            </div>
        </div>
    </div>

    <div id="codeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Code Preview</h2>
            <div id="preview-container"></div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyCQEpPLeLvxUIpmSiJPu0pAm99VBAx9xBA'; // استبدل بمفتاح API الخاص بك
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent';

        const sidebar = document.getElementById('sidebar');
        const toggleSidebar = document.getElementById('toggle-sidebar');
        const modeToggle = document.getElementById('mode-toggle');
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const modal = document.getElementById('codeModal');
        const closeModal = document.getElementsByClassName('close')[0];
        const previewContainer = document.getElementById('preview-container');

        toggleSidebar.addEventListener('click', () => {
            sidebar.classList.toggle('closed');
        });

        modeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            updateModeIcon();
        });

        function updateModeIcon() {
            const icon = modeToggle.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        closeModal.onclick = function() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function sendMessage() {
            const message = userInput.value.trim();
            if (message) {
                addMessageToChat('user', message);
                userInput.value = '';
                fetchAIResponse(message);
            }
        }


        //Generat avatar
        function generateAvatar(name) {
            const initials = name.split('').map(word => 
            word[0],toUpperCase()).join('').slice(0, 3);

            const color = generateColorFromName(name);

            return{
                initials,
                color
            };
        }

        //Generat color 
        function generateColorFromName(name){
            let hash = 0;
            for(let i = 0; i < name.lenght; i++) {
                hash = name.charCodeAt(i) + ((hash << 5) - hash);
            }
            const color = ((hash << 8) & 0xFF) ^ 0xAA;
            return `#${(color & 0xFFFFFF).toString(16).padStart(6, '0')}`;
        }


        //add message to container
        function addMessageToChat(sender, message) {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('message-wrapper');
        
            const avatarElement = document.createElement('img');
            avatarElement.classList.add('avatar');
        
            // تعيين أيقونة المستخدم أو AI حسب المرسل
            if (sender === 'user') {
                avatarElement.src = 'https://s.gravatar.com/avatar/0e984cbe5384a4cb7e3c2a2c1f6b1267?s=480&r=pg&d=https%3A%2F%2Fcdn.auth0.com%2Favatars%2Fur.png'; // رابط صورة الـ Avatar الخاص بالمستخدم
                messageWrapper.classList.add('user-message-wrapper'); // رسائل المستخدم تكون على اليمين
            } else {
                avatarElement.src = 'https://example.com/ai-avatar.png'; // رابط صورة الـ Avatar الخاص بـ AI
                messageWrapper.classList.add('ai-message-wrapper'); // رسائل الـ AI تكون على اليسار
            }
        
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${sender}-message`);
            messageElement.innerHTML = sender === 'user' ? message : formatResponse(message);
        
            // إضافة الصورة والرسالة إلى الحاوية
            messageWrapper.appendChild(avatarElement);
            messageWrapper.appendChild(messageElement);
        
            // إضافة الرسالة إلى الحاوية الرئيسية
            chatContainer.appendChild(messageWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        
            if (sender === 'ai') {
                hljs.highlightAll();
                setupCodeButtons();
            }
        }
        
        
        
        

        async function fetchAIResponse(message) {
            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: message
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                addMessageToChat('ai', aiResponse);
            } catch (error) {
                console.error('Error:', error);
                addMessageToChat('ai', 'Sorry, an error occurred while processing your request.');
            }
        }

        function formatResponse(response) {
            // تنسيق الفقرات
            response = response.replace(/\n\n/g, '</p><p>');
            response = '<p>' + response + '</p>';

            // تنسيق العناوين
            response = response.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            response = response.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            response = response.replace(/^# (.*$)/gim, '<h1>$1</h1>');

            // تنسيق القوائم
            response = response.replace(/^\s*(\d+\.|\*|\-)\s/gm, '<li>');
            response = response.replace(/<\/li>\s*<li>/g, '</li><li>');
            response = response.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');

            // تنسيق الجداول
            response = response.replace(/\n?(\|[^\n]+\|)\n(\|[-:| ]+\|)(\n\|[^\n]+\|)+/g, match => {
                const rows = match.trim().split('\n');
                let table = '<div class="table-container"><div class="table-controls"><button onclick="downloadPDF(this)"> <i class="fas fa-download"></i> <i class="fas fa-file-pdf"></i> PDF</button> <button onclick="downloadCSV(this)"><i class="fas fa-download"></i> CSV  <i class="fa fa-file-csv"></i> </button><input type="color" id="color-picker" onchange="changeTableColor(this)"></div><table>';
                rows.forEach((row, index) => {
                    const cells = row.split('|').filter(cell => cell.trim() !== '');
                    const cellType = index === 0 ? 'th' : 'td';
                    table += `<tr>${cells.map(cell => `<${cellType}>${cell.trim()}</${cellType}>`).join('')}</tr>`;
                });
                table += '</table></div>';
                return table;
            });

            // تنسيق كتل الكود
            response = response.replace(/```(\w+)?\n([\s\S]+?)```/g, (match, language, code) => {
                return `<pre><code class="language-${language || ''}">${code.trim()}</code></pre>`;
            });

            // تنسيق الكود الداخلي
            response = response.replace(/`([^`]+)`/g, '<code>$1</code>');

            // تنسيق النص العريض
            response = response.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            // تنسيق النص المائل
            response = response.replace(/\*(.*?)\*/g, '<em>$1</em>');

            // تنسيق الروابط
            response = response.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

            // تنسيق الاقتباسات
            response = response.replace(/^\> (.*$)/gim, '<blockquote>$1</blockquote>');

            // تنسيق الخطوط الأفقية
            response = response.replace(/^\-{3,}/gim, '<hr>');

            // تنسيق الرموز التعبيرية
            response = response.replace(/:([\w+-]+):/g, (match, emoji) => {
                return `<span class="emoji" title="${emoji}">&#x${emojiMap[emoji] || '2753'};</span>`;
            });

            return response;
        }

        function setupCodeButtons() {
            const codeBlocks = document.querySelectorAll('pre');
            codeBlocks.forEach(block => {
                if (!block.querySelector('.copy-button')) {
                    const copyButton = document.createElement('button');
                    copyButton.textContent = 'Copy';
                    copyButton.className = 'copy-button';
                    copyButton.onclick = function() { copyCode(this); };
                    block.appendChild(copyButton);
                }

                if (!block.querySelector('.run-button')) {
                    const runButton = document.createElement('button');
                    runButton.textContent = 'Run';
                    runButton.className = 'run-button';
                    runButton.onclick = function() { runCode(this); };
                    block.appendChild(runButton);
                }
            });
        }

        function copyCode(button) {
            const pre = button.parentElement;
            const code = pre.querySelector('code');
            const range = document.createRange();
            range.selectNode(code);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            button.textContent = 'Copied!';
            setTimeout(() => { button.textContent = 'Copy'; }, 2000);
        }

        function runCode(button) {
            const pre = button.parentElement;
            const code = pre.querySelector('code').textContent;
            previewContainer.innerHTML = code;
            modal.style.display = "block";
        }

        function downloadPDF(button) {
            const table = button.closest('.table-container').querySelector('table');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.autoTable({ html: table });
            doc.save('table.pdf');
        }

        function downloadCSV(button) {
            const table = button.closest('.table-container').querySelector('table');
            const data = [];
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const rowData = [];
                const cells = row.querySelectorAll('th, td');
                cells.forEach(cell => rowData.push(cell.textContent));
                data.push(rowData);
            });
            const csv = Papa.unparse(data);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (navigator.msSaveBlob) {
                navigator.msSaveBlob(blob, 'table.csv');
            } else {
                link.href = URL.createObjectURL(blob);
                link.download = 'table.csv';
                link.click();
            }
        }

        function changeTableColor(input) {
            const table = input.closest('.table-container').querySelector('table');
            table.style.backgroundColor = input.value;
        }

        const emojiMap = {
            'smile': '1F604',
            'laugh': '1F606',
            'wink': '1F609',
            'heart': '2764',
            'thumbsup': '1F44D',
            'thumbsdown': '1F44E',
            'fire': '1F525',
            'rocket': '1F680',
            'star': '2B50',
            // أضف المزيد من الرموز التعبيرية حسب الحاجة
        };

        // رسالة الترحيب الأولية
        addMessageToChat('ai', 'Hello! How can I assist you today?\n\nI\'m an advanced AI assistant capable of helping with a wide range of tasks, including:\n\n1. Answering questions\n2. Providing detailed explanations\n3. Offering creative suggestions\n4. Helping with complex analysis\n5. Assisting with coding tasks\n6. Creating and formatting tables\n7. Using emojis for expressive communication :smile:\n\nFeel free to ask me anything, and I\'ll do my best to help! :rocket:');
    </script>
</body>
</html>


